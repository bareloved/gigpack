# Internationalization (i18n) Documentation

## Overview

Gigmaster supports internationalization (i18n) using `next-intl` with URL-based routing. The app currently supports English (`en`) and Hebrew (`he`), with full RTL (right-to-left) support for Hebrew.

## Architecture

### Library
- **next-intl**: A mature i18n library for Next.js App Router that provides excellent TypeScript support and server/client component compatibility.

### Locale Structure
- Locales are defined in `i18n/config.ts`
- Supported locales: `en` (English), `he` (Hebrew)
- Default locale: `en`
- RTL locales: `he`

### URL Structure
The app uses URL-based routing with locale prefixes:
- English: `/en/...`
- Hebrew: `/he/...`

The root path (`/`) redirects to the default locale (`/en`).

## File Structure

```
i18n/
  ├── config.ts          # Locale configuration and types
  ├── request.ts         # Server-side locale handling
  └── routing.ts         # Routing configuration and navigation helpers

messages/
  ├── en.json            # English translations
  └── he.json            # Hebrew translations

middleware.ts            # Locale detection and routing middleware
```

## Translation Files

Translations are organized by domain in JSON files:

- `common` - Shared UI elements (buttons, labels, navigation)
- `auth` - Authentication pages (sign-in, sign-up)
- `dashboard` - Dashboard page
- `gigpack` - Gig pack forms and related UI
- `public` - Public gig pack view

### Adding New Translation Keys

1. Add the key to `messages/en.json`:
```json
{
  "common": {
    "newKey": "New English Text"
  }
}
```

2. Add the Hebrew translation to `messages/he.json`:
```json
{
  "common": {
    "newKey": "טקסט עברי חדש"
  }
}
```

3. Use in components:
```tsx
import { useTranslations } from "next-intl";

function MyComponent() {
  const t = useTranslations("common");
  return <div>{t("newKey")}</div>;
}
```

## Usage in Components

### Client Components

Use the `useTranslations` hook:

```tsx
"use client";

import { useTranslations } from "next-intl";

export function MyComponent() {
  const t = useTranslations("common");
  const tAuth = useTranslations("auth");
  
  return (
    <div>
      <button>{t("save")}</button>
      <p>{tAuth("signIn")}</p>
    </div>
  );
}
```

### Server Components

Use `getTranslations`:

```tsx
import { getTranslations } from "next-intl/server";

export default async function MyPage() {
  const t = await getTranslations("common");
  
  return <h1>{t("title")}</h1>;
}
```

### Navigation

Use the `Link` component from `@/i18n/routing` instead of Next.js `Link`:

```tsx
import { Link } from "@/i18n/routing";

<Link href="/gigpacks">Go to Dashboard</Link>
```

This ensures the locale prefix is maintained in the URL.

### Programmatic Navigation

Use `useRouter` from `next/navigation` - the locale is handled automatically by the middleware:

```tsx
import { useRouter } from "next/navigation";

const router = useRouter();
router.push("/gigpacks"); // Automatically includes locale prefix
```

## Language Switcher

The language switcher component (`components/language-switcher.tsx`) allows users to switch between languages. It:

- Displays current locale
- Switches locale via URL navigation
- Persists locale preference via cookie (handled by middleware)

### Adding to a Page

```tsx
import { LanguageSwitcher } from "@/components/language-switcher";

<LanguageSwitcher />
```

## RTL Support

RTL (right-to-left) support is handled automatically:

1. The `dir` attribute is set on the `<html>` element based on locale (`rtl` for Hebrew, `ltr` for English)
2. Tailwind CSS automatically handles RTL when `dir="rtl"` is set
3. Icons and spacing adjust automatically using Tailwind's logical properties

### Manual RTL Adjustments

If you need to manually adjust for RTL, use Tailwind's logical properties:

```tsx
// Instead of: className="mr-2"
// Use: className="me-2" (margin-end)

// Instead of: className="ml-2"  
// Use: className="ms-2" (margin-start)
```

## Date Formatting

The `formatDate` function in `lib/utils.ts` is locale-aware:

```tsx
import { formatDate } from "@/lib/utils";
import { useLocale } from "next-intl";

function MyComponent() {
  const locale = useLocale();
  const formattedDate = formatDate(dateString, locale);
  // Returns Hebrew-formatted date for Hebrew locale
}
```

## Adding a New Language

1. Add the locale to `i18n/config.ts`:
```ts
export const locales = ['en', 'he', 'fr'] as const;
```

2. Add to `i18n/routing.ts`:
```ts
export const routing = defineRouting({
  locales: ['en', 'he', 'fr'],
  defaultLocale: 'en',
});
```

3. Create `messages/fr.json` with all translation keys

4. If the language is RTL, add it to `rtlLocales` in `i18n/config.ts`:
```ts
export const rtlLocales: Locale[] = ['he', 'ar'];
```

5. Add locale name to `localeNames`:
```ts
export const localeNames: Record<Locale, string> = {
  en: 'English',
  he: 'עברית',
  fr: 'Français',
};
```

## Locale Detection

The middleware (`middleware.ts`) handles locale detection:

1. Checks URL for locale prefix (`/en/...`, `/he/...`)
2. Falls back to default locale if no match
3. Sets locale cookie for persistence

## Best Practices

1. **Always use translation keys** - Never hardcode user-facing strings
2. **Organize by domain** - Group related translations together
3. **Use descriptive keys** - `gigpack.title` is better than `title`
4. **Keep keys consistent** - Use the same key structure across domains
5. **Test both languages** - Always verify Hebrew translations and RTL layout
6. **Use logical properties** - Prefer `me-`/`ms-` over `mr-`/`ml-` for spacing

## Troubleshooting

### Translations not showing
- Ensure the component is wrapped in `NextIntlClientProvider` (done in `app/[locale]/layout.tsx`)
- Check that the translation key exists in both `en.json` and `he.json`
- Verify the namespace matches (`useTranslations("namespace")`)

### RTL layout broken
- Ensure `dir="rtl"` is set on the `<html>` element (handled automatically)
- Check that Tailwind classes use logical properties where needed
- Verify icon positioning uses `me-`/`ms-` instead of `mr-`/`ml-`

### Locale not persisting
- Check that middleware is properly configured
- Verify cookies are enabled in the browser
- Check browser console for middleware errors

## References

- [next-intl Documentation](https://next-intl-docs.vercel.app/)
- [Next.js Internationalization](https://nextjs.org/docs/app/building-your-application/routing/internationalization)
- [Tailwind CSS RTL Support](https://tailwindcss.com/docs/hover-focus-and-other-states#rtl-support)

